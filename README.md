# 2048游戏 - C++实现

这是一个功能完整的2048游戏，使用C++和SFML图形库开发，具有华丽的UI、平滑动画、进度保存和排行榜系统。

## 功能特性

### 核心功能
- ✅ 经典2048游戏规则（4x4网格）
- ✅ 方向键控制（↑ ↓ ← →）
- ✅ 自动检测胜利（达到2048）和失败（无法移动）
- ✅ 实时分数显示

### 华丽UI
- ✅ 不同数值的方块使用不同配色
- ✅ 平滑的滑动动画（200ms）
- ✅ 合并时的弹出动画
- ✅ 新方块生成的缩放动画
- ✅ 动画期间自动锁定输入（避免状态不一致）
- ✅ 清晰的状态提示（游戏中/胜利/失败）

### 持久化系统
- ✅ **进度保存**: 自动保存游戏状态到 `save.txt`
  - 每次有效移动后自动保存
  - 启动时可选择继续或重新开始
  - 保存内容：用户名、分数、4x4网格

- ✅ **排行榜系统**: 使用链表实现的持久化排行榜
  - 数据存储在 `ranks.txt`
  - 支持插入、更新、删除操作
  - 按分数降序排列
  - 同名用户自动更新最高分
  - 显示全局最高分

## 项目结构

```
2048-motivate/
├── main.cpp              # 主函数（最小启动代码）
├── Makefile              # 编译配置
├── include/              # 头文件目录
│   ├── Board.h           # 游戏逻辑（纯数据层）
│   ├── MoveEvent.h       # 动画事件定义
│   ├── Animator.h        # 动画系统
│   ├── Renderer.h        # 渲染器（SFML绘制）
│   ├── SaveManager.h     # 存档管理
│   ├── RankList.h        # 排行榜（链表实现）
│   └── Game.h            # 游戏主控制器
└── src/                  # 实现文件目录
    ├── Board.cpp
    ├── Animator.cpp
    ├── Renderer.cpp
    ├── SaveManager.cpp
    ├── RankList.cpp
    └── Game.cpp
```

## 架构设计

### 分层架构
1. **逻辑层** (`Board`): 纯int网格操作，不涉及像素、渲染、动画
2. **动画层** (`Animator`, `MoveEvent`): 基于事件的动画系统
3. **渲染层** (`Renderer`): SFML绘制，使用视觉方块状态
4. **控制层** (`Game`): 状态机，协调输入→逻辑→动画→保存流程

### 关键设计决策
- **逻辑与渲染分离**: Board只处理数字，Renderer只处理像素
- **快照式动画**: 移动前后对比生成事件，动画不修改逻辑状态
- **输入锁定**: 动画进行时自动忽略输入，确保状态一致性
- **链表排行榜**: 满足数据结构要求，支持完整CRUD操作

## 编译和运行

### 依赖项
- C++17编译器（g++ 7+）
- SFML 2.5+图形库

### 安装SFML

**Ubuntu/Debian:**
```bash
sudo apt-get install libsfml-dev
```

**Arch Linux:**
```bash
sudo pacman -S sfml
```

**macOS:**
```bash
brew install sfml
```

### 编译
```bash
cd /home/lyl/ALL_C++/2048-motivate
make
```

### 运行
```bash
./2048
```

或者直接：
```bash
make run
```

### 清理
```bash
make clean        # 删除所有生成文件（包括存档）
make clean-obj    # 只删除目标文件
make rebuild      # 重新编译
```

## 操作说明

### 主菜单
- **↑/↓**: 选择菜单选项
- **Enter**: 确认选择
- 选项：
  - **Continue Game**: 继续上次的游戏（如果有存档）
  - **New Game**: 开始新游戏
  - **Exit**: 退出

### 游戏中
- **↑**: 向上移动
- **↓**: 向下移动
- **←**: 向左移动
- **→**: 向右移动

### 游戏结束
- **R**: 重新开始游戏

## 游戏规则

1. **目标**: 合并相同数字的方块，达到2048
2. **移动**: 每次移动，所有方块向指定方向滑动
3. **合并**: 相同数值的方块碰撞时合并，分数增加
4. **生成**: 每次有效移动后随机生成新方块（2占90%，4占10%）
5. **胜利**: 出现2048方块（可继续游戏）
6. **失败**: 网格填满且无法移动

## 数据文件格式

### save.txt（游戏存档）
```
用户名
分数
v00 v01 v02 v03
v10 v11 v12 v13
v20 v21 v22 v23
v30 v31 v32 v33
```

### ranks.txt（排行榜）
```
用户名1 分数1
用户名2 分数2
...
```
（按分数降序排列）

## 技术亮点

1. **完整的动画系统**: 基于事件驱动，支持移动、合并、生成三种动画
2. **状态机设计**: Menu → Playing → Won/GameOver，清晰的状态转换
3. **自动保存**: 每次移动后自动保存，无需手动操作
4. **链表数据结构**: 排行榜使用手动实现的链表，支持完整CRUD
5. **无阻塞动画**: 使用deltaTime更新，60 FPS流畅运行
6. **健壮的移动逻辑**: 正确处理 [2,2,2,2] 等边缘情况

## 已测试的边缘情况

- ✅ [2,2,2,2] 合并规则正确
- ✅ 无效移动不生成新方块
- ✅ 游戏结束检测准确
- ✅ 保存/加载恢复完整状态
- ✅ 排行榜同名用户更新逻辑
- ✅ 动画期间输入锁定
- ✅ 空单元格不渲染

## 开发者

资深C++桌面游戏开发者

## 许可证

本项目仅供学习和演示使用。

